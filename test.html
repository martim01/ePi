<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 5.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
	<head>
		<meta name="description" content="" >
		<meta name="author" content="Matthew Martin">
		<meta name="keywords" content="" >
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<meta http-equiv="Expires" content="Mon, 26 Jul 1980 05:00:00 GMT">
		<meta http-equiv="Expires" content="0">
		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-cache, must-revalidate, post-check=0, pre-check=0">
		<meta http-equiv="Cache-Control" content="max-age=0">
		<title>ePI</title>
		<script type="text/javascript" language="javascript">
			
			function ws_connect(endpoint)
			{
				console.log("ws_connect: "+'ws://' + endpoint);
				var g_ws = new WebSocket('ws://' + endpoint);
				
				g_ws.onopen = function(ev)  { console.log(ev); };
				g_ws.onerror = function(ev) { console.log(ev); };
				g_ws.onclose = function(ev) { console.log(ev); };
				g_ws.filter = function(jsonObj){};
	
				g_ws.onmessage = function(ev) 
				{
					var jsonObj = JSON.parse(ev.data);
					console.log(jsonObj);
					
					
					if(jsonObj["player"] !== undefined)
					{
						
						
						document.getElementById("player").innerHTML = jsonObj["player"];
						if(jsonObj["status"] !== undefined)
						{
							if(jsonObj["status"]["count"] !== undefined)
							{
								document.getElementById("count").innerHTML = jsonObj["status"]["count"];
							}
						}
						else
						{
							document.getElementById("count").innerHTML = "";
						}
							
						
						if(jsonObj["exit"] !== undefined)
						{
							
							if(jsonObj["exit"]["code"] !== undefined)
							{
								document.getElementById("exit_code").innerHTML = jsonObj["exit"]["code"];
							}
							else
							{
								document.getElementById("exit_code").innerHTML = "";
							}
							
							
							if(jsonObj["exit"]["signal"] !== undefined)
							{
								document.getElementById("exit_signal").innerHTML = jsonObj["exit"]["signal"]["code"];
								document.getElementById("exit_signal_description").innerHTML = jsonObj["exit"]["signal"]["description"];
							}
							else
							{
								document.getElementById("exit_signal").innerHTML = "";
								document.getElementById("exit_signal_description").innerHTML = "";
							}
						}
						else
						{
							document.getElementById("exit_signal").innerHTML = "";
							document.getElementById("exit_signal_description").innerHTML = "";
							document.getElementById("exit_code").innerHTML = "";
						}
							
							
					}
				}
			}
					
			function postSchedule()
			{
				console.log("postSchedule");
				
				var ajax = new XMLHttpRequest();
				ajax.onreadystatechange = function()
				{
					console.log(this.readyState+"="+this.responseText);
					
					if(this.readyState == 4)
					{
						var jsonObj = JSON.parse(this.responseText);
						console.log(jsonObj);
					}
				}
				var schedule = { "label" : "test", "description" : "test schedule", "schedule" : [ { "offset" : 0, "file" : "4f45fced-e5c3-3bd6-b133-15fd2ce62b5c", "loop" : false } ] };
				console.log(schedule);
				ajax.open("POST", "http://192.168.0.101:8080/x-epi/schedules",true);
				ajax.setRequestHeader("Content-type", "application/json");
				ajax.send(JSON.stringify(schedule));
			}
			function postPlaylist()
			{
				console.log("postSchedule");
				
				var ajax = new XMLHttpRequest();
				ajax.onreadystatechange = function()
				{
					console.log(this.readyState+"="+this.responseText);
					
					if(this.readyState == 4)
					{
						var jsonObj = JSON.parse(this.responseText);
						console.log(jsonObj);
					}
				}
				var schedule = { "label" : "usher", "description" : "Usher", "files" : [ { "uid" : "1b77ce42-fa03-3ab8-8570-da65c8909a9d", "times_to_play" : 1 }, { "uid" : "3745251b-dce9-30c8-bc9c-17678ed2c001", "times_to_play" : 1 },{ "uid" : "9da24e0a-e14c-3cb0-91df-26af522c3f22", "times_to_play" : 1 }] };
				console.log(schedule);
				ajax.open("POST", "http://192.168.0.101:8080/x-epi/playlists",true);
				ajax.setRequestHeader("Content-type", "application/json");
				ajax.send(JSON.stringify(schedule));
			}
			
			function upload_file()
			{
				var fd = new FormData(document.getElementById('upload_form'));
				
				var ajax = new XMLHttpRequest();
				ajax.onreadystatechange = function()
				{
					
					if(this.readyState == 4)
					{
						var jsonObj = JSON.parse(this.responseText);
						console.log(jsonObj);
						
					}
				}
				ajax.open('POST','http://192.168.0.101:8080/x-epi/files');
				ajax.send(fd);
				
			}
			function play()
			{
				console.log("play");
				
				var ajax = new XMLHttpRequest();
				ajax.onreadystatechange = function()
				{
					
					if(this.readyState == 4)
					{
						var jsonObj = JSON.parse(this.responseText);
						console.log(jsonObj);
					}
				}
				var play = { "command" : "play", "type" : "file", "uid" : "714e5e37-77bc-30ae-97d8-defdcab64d1d", "times_to_play" : 2};
				
				console.log(play);
				ajax.open("PUT", "http://192.168.0.101:8080/x-epi/status",true);
				ajax.setRequestHeader("Content-type", "application/json");
				ajax.send(JSON.stringify(play));
			}
			function playPlaylist()
			{
				console.log("playPlaylist");
				
				var ajax = new XMLHttpRequest();
				ajax.onreadystatechange = function()
				{
					
					if(this.readyState == 4)
					{
						var jsonObj = JSON.parse(this.responseText);
						console.log(jsonObj);
					}
				}
				var play = { "command" : "play", "type" : "playlist", "uid" : "67338769-6ab7-3d1d-86e1-14d536207e05", "times_to_play" : 1, "shuffle": false};
				
				console.log(play);
				ajax.open("PUT", "http://192.168.0.101:8080/x-epi/status",true);
				ajax.setRequestHeader("Content-type", "application/json");
				ajax.send(JSON.stringify(play));
			}
			
			
			function stop()
			{
				console.log("stop");
				
				var ajax = new XMLHttpRequest();
				ajax.onreadystatechange = function()
				{
					
					if(this.readyState == 4)
					{
						var jsonObj = JSON.parse(this.responseText);
						console.log(jsonObj);
					}
				}
				var play = { "command" : "stop"};
				
				console.log(play);
				ajax.open("PUT", "http://192.168.0.101:8080/x-epi/status",true);
				ajax.setRequestHeader("Content-type", "application/json");
				ajax.send(JSON.stringify(play));
			}
		</script>
	</head>
	<body onload="ws_connect('192.168.0.101:8080')">
	<button onclick="postSchedule()">Schedule</button>
	<button onclick="postPlaylist()">Playlist</button>
	<form method="post" enctype="multipart/form-data" style="text-align: left" onsubmit="return false;" id="upload_form">
		<div class="grid grid_server" id="upload_grid">
		<div class="grid grid_title" style="margin-top: 4px">Label:</div><div><input type="text" name="label_1"></div>
		<div class="grid grid_title" style="margin-top: 4px">Description:</div><div><input type="text" name="description_1"></div>
		<div class="grid_title" style="margin-top: 4px">Action:</div><div><input type="file" name="file_1" class="a_button" accept=".wav;*.mp3"> <button onclick="upload_file()">Upload</button></div>
		</div>
	</form>
	<button onclick="play()">Play</button>
	<button onclick="playPlaylist()">Play Playlist</button>
	<button onclick="stop()">Stop</button>
	<div><span>Player</span> <span id="player"></span></div>
	<div><span>Status</span> <span id="count"></span></div>
	<div><span>Exit: Code</span> <span id="exit_code"></span></div>
	<div><span>Exit: Signal</span> <span id="exit_signal"></span></div>
	<div><span>Exit: Signal</span> <span id="exit_signal_description"></span></div>
	</body>
</html>
